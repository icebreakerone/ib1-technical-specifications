# Member Identity Digital Certificates

The Directory issues x509 digital certificates to Members for:

 * Clients: to prove identity when connecting to a server
 * Signing: to sign data at rest, for example, Provenance records
 * Servers: to verify a server is run by a Member of the Trust Framework

Client and Signing certificates include the Directory URL of an Application in the Subject of the certificate. Applications identify a use of data in the Trust Framework and the Roles the Member is using. The Member's Directory URL and the Roles in use are included as extensions in the certificates.

Client and Signing certificates are long-lived, obtained by logging into the Directory, and a Certificate Revocation List must be checked by servers and when signatures are checked.

Server certificates only include the DNS name of the server. The Member who operates them is implied by the Directory, as Clients discover services using Directory and Data Catalog entries which include the Member's identity.

Server certificates are short-lived and automatically renewed.

## Client certificates

Presentation of a client certificate provides:

 * assurance that the client is operated by a member of the Trust Framework
 * the Directory URL of the Application, which identifies this use of data in all metadata
 * a subset of the Member's roles (group membership) in their Schemes
 * the Member's Directory URL

Client certificates are valid for 12 months.

 * CN=[Trust Framework] Client CA
    * CN=[Trust Framework] Client Issuer
        * C=[Country code] O=[Client Name] CN=[Application Directory URL], subjectAlternativeName=URI:[Application Directory URL]

See below for the x509 extensions that are required for the certificates.

### Obtaining a client certificate

A member logs into the Directory, or uses an API, provides a CSR, and requests a client certificate. The Directory generates a certificate which encodes the Application, Member identity and Roles, ignoring everything other than the public key in the CSR.

The client must manually renew the certificate before it expires.

### Verifying a client certificate

A server must verify that

 * a client certificate has been presented and it has not expired
 * the client certificate is issued with a certificate chain leading to the client root certificate
 * the client certificate has not been revoked
 * the Roles extension contains the required role to access the API.


## Signing certificates

Members sign metadata with signing certificates to prove that they created it at a specified time. The signing certificates and their issuer chain may either be included along with the signed data, or fetched from the Directory using their serial number.

Signing certificates are valid for 12 months.

 * CN=[Trust Framework] Signing CA
    * CN=[Trust Framework] Signing Issuer
        * C=[Country code] O=[Client Name] CN=[Application Directory URL], subjectAlternativeName=URI:[Application Directory URL]

See below for the x509 extensions that are required for the certificates.

### Obtaining a signing certificate

A member logs into the Directory, or uses an API, provides a CSR, and requests a signing certificate. The Directory generates a certificate which encodes the Application, Member identity and Roles, ignoring everything other than the public key in the CSR..

The client must manually renew the certificate before it expires.

### Verifying a signing certificate

A member verifying signed must verify that

 * the signing certificate is issued with a certificate chain leading to the client root certificate
 * the signing certificate has not been revoked
 * the signing certificate was valid at the time of signature
 * if applicable, the Roles extension contains the required role to generate the metadata.


## Server certificates

Presentation of a server certificate with a CN that matches the hostname of the server provides assurance that the server operator is a member of the Trust Framework.

This assertion relies on only issuing certificates to servers which are registered explicitly (Member record) or implicitly (data catalog entries) in the Directory.

Server certificates are short-lived, with a maximum validity of 24 hours.

 * CN=[Trust Framework] Server CA
    * CN=[Trust Framework] Server Issuer
        * CN=[DNS name of server], subjectAlternativeName=DNS:[DNS name of server]

See below for the x509 extensions that are required for the certificates.

### Obtaining a server certificate

 * Ensure the Directory contains a record which refers to this server.
 * Use ACME to obtain and automatically renew a short-lived certificate. The ACME server:
    * Uses HTTP challenge to verify the DNS name
    * Is configured to only issue certificates to hostnames under the domain of the publishers configured in the Directory.

### Verifying a server certificate

A client must configure their TLS client to only trust connections to servers with certificates issued with a certificate chain leading to the root Server certificate.



## IB1 x509 extensions

Trust Framework certificates use x509 extensions defined under IB1's ASN.1 OID prefix, `1.3.6.1.4.1.62329`, to provide additional identity information.

`ib1Roles` (`1.3.6.1.4.1.62329.1.1`)
: One or more Directory URLs of the Member's Roles when acting with this certificate, as an ASN.1 encoded SEQUENCE of UTF8 strings. This list of Roles may be a subset of the Member's Roles.

`ib1Member` (`1.3.6.1.4.1.62329.1.3`)
: The Directory URL of the Member, as an ASN.1 encoded UTF8 string.

## Certificate Profiles

### CA certificates

The root CA certificates must conform to the _Root CA Certificate Profile_ defined in the version of the [CA/Browser Forum Baseline Requirements for TLS Server Certificates](https://cabforum.org/working-groups/server/baseline-requirements/documents/) in force at the time of creation.

Root CA certificates use ECDSA keys with the secp384r1 (P-384) curve, and have a 9132 day (approx 25 years) validity time. Their private keys are kept offline, and only used to create Issuer certificates.

### Issuer certificates

The Issuer certificates must conform to the _TLS Subordinate CA Certificate Profile_ defined in the version of the [CA/Browser Forum Baseline Requirements for TLS Server Certificates](https://cabforum.org/working-groups/server/baseline-requirements/documents/) in force at the time of creation.

Issuer certificates are regularly regenerated. To comply with the [RFC5280 Basic Path Validation algorithm](https://datatracker.ietf.org/doc/html/rfc5280#section-6.1), their validity time is the validity time of a member certificate plus the regeneration period.

They use ECDSA keys with the secp256r1 (P-256) curve.

### Member certificates

Member certificates must conform to the _Subscriber (End-Entity) Certificate Profile_ defined in the version of the [CA/Browser Forum Baseline Requirements for TLS Server Certificates](https://cabforum.org/working-groups/server/baseline-requirements/documents/) in force at the time of issue.

They use ECDSA keys with the secp256r1 (P-256) curve.

Client and Signing certificates must also include the following additional extensions:

 * Subject Alternative Name with a the Member URL as a URI type name.
 * ib1Roles
 * ib1Member

### Summary of required extensions for Member certificates

| Extension | Client | Signing | Server |
| --------- | ------ | ------- | ------ |
| Subject Alternative Name (DNS name) | | | Yes |
| Subject Alternative Name (Member URL as URI) | Yes | Yes |  |
| ib1Roles | Yes | Yes |  |
| ib1Member | Yes | Yes |  |
| Subject Key Identifier | Yes | Yes | Yes |
| Authority Key Identifier | Yes | Yes | Yes |
| Basic Constraints | Yes | Yes | Yes |
| Key Usage | Yes | Yes | Yes |
| Extended Key Usage | | | Yes |
