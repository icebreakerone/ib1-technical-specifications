# Member Identity Digital Certificates

## Client certificates

Presentation of a client certificate provides:

 * assurance that the client is operated by a member of the Trust Framework
 * the Participant’s Directory URL, which is also their OAuth client_id
 * a subset of the Participant’s group membership (roles) in their Schemes

The certificate chain looks like:

| Certificate DN | Validity | Description |
| -------------- | -------- | ----------- |
| CN=[Trust Framework] Client CA | 35 years | The root certificate for TF Shared Data clients, with the private key stored offline. All servers configured to allow client certificates with this as a root. |
| CN=[Trust Framework] Group Issuer | 19 months | An intermediate certificate used for day to day signing by the Directory. Created using the offline private key, manually updated every 6 months. |
| C=[Country code] O=[Client Name] CN=[Member Directory URL] + X509 extensions for Application & Roles | 12 months | Directory signs certificate requests for clients. A client will have many certificates. They are renewed automatically after a random period of time up to 23 hours, to avoid all the certificates being renewed at the same time. |


## x509 v3 extensions

`1.3.6.1.4.1.62329` is IB1’s ASN.1 OID prefix.

`1.3.6.1.4.1.62329.1.1` -- Roles
: The Directory URLs of the Member’s Roles when acting with this certificate, as an ASN.1 encoded SEQUENCE of UTF8 strings.

`1.3.6.1.4.1.62329.1.2` -- Application
: The Directory URL of the Application, as an ASN.1 encoded UTF8 string.


## Obtaining a client certificate

A client logs into the Directory, or uses an API, provides a CSR, and requests a signed certificate. The Directory generates a certificate which encodes the client_id and roles (group membership) in the DN, ignoring any DN in the CSR.

The client must manually renew the certificate within 12 months.

## Verifying a client certificate

A server must:

 * Check the client certificate is issued by the root certificate
 * Check that the client certificate has not been revoked
 * Check that the DN contains the required expected role in the OU attributes.

## Server certificates

Presentation of a server certificate with a CN for that matches the hostname of the server provides assurance that the server operator is a member of the Trust Framework.

This assertion relies on only issuing certificates to servers which are registered explicitly (participant record) or implicitly (data catalog entries) in the Directory.

The server certificates do not need to be checked for revocation by the client. If any certificate needs to be withdrawn, it is just replaced, and all the leaf certificates which rely on it will be invalid within 24 hours. (except for the root certificate!)

| Certificate DN | Validity | Description |
| -------------- | -------- | ----------- |
| CN=[Trust Framework] Server CA | 35 years | The root certificate for TF Shared Data servers, with the private key stored offline. All clients configured to trust servers with certificates signed by this CA. |
| CN=[Trust Framework] Issuer | 7 months | An intermediate certificate used for day to day signing by the Directory. Created using the offline private key, manually updated every 6 months. |
| CN=[DNS name of server], DNS name in subject alt names | 24 hours | Directory signs certificate requests for servers. |

## Obtaining a server certificate

 * Ensure the Directory contains a record which refers to this server.
 * Use ACME to obtain and automatically renew a short lived certificate, where the server:
 * Uses HTTP challenge to verify the DNS name
 * Is configured to only issue certificates to hostnames under the domain of the publishers configured in the Directory. (Since this is a short list, manual configuration would be fine.)

## Verifying a server certificate

A client must:

 * Obtain the root certificate
 * Configure the SSL client to only trust connections to servers with certificates signed by the root certificate.

